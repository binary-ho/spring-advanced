
소프트웨어 개발에서 변경 지점은 하나가 될 수 있도록 잘 모듈화 해야한다. <br>
그런데, 부가 기능처럼 특정 로직을 어플리케이션 전반에 적용하는 문제는 일반적인 OOP 방식으로는 해결이 어렵다. <br>


## AOP
드디어 AOP. <br>
핵심과 부가 기능을 분리하는 개념으로 AOP가 있다. <br>
부가 기능을 핵심 기능과 분리하고 한 곳에서 관리하도록 했다. <Br>
그리고 부가 기능을 어디에 적용할지 선택하는 기능도 만들었다. <br>
이렇게 부가 기능과 부가 기능을 어디에 적용할지 선택하는 기능을 합해 하나의 모듈로 만들었는데, 이것이 바로 에스펙트이다. <br>

에스펙트는 `관점`이라는 의미로 쉽게 이야기해서 `부가 기능`과 `부가 기능을 어디에 적용할지` 정의한 것이다. <br>
애플리케이션을 바라보는 관점을 하나하나의 기능에서 횡단 관심사 관점으로 달리 보는 것이다. <br>

AOP는 스프링이 제공해주는 AOP를 적용해도 되고, 대표적인 구현인 AspectJ 프래임워크가 있다.
1. 자바 프로그래밍 언어에 대한 완벽한 AOP 확장
2. 횡단 관심사의 깔끔한 모듈화
   - 오류 검사 및 처리
   - 동기화
   - 캐싱을 통한 성능 최적화
   - 모니터링 및 로깅

## AOP 적용 방식
AOP를 사용하면 핵심 기능과 부가 기능을 코드상으로 나눌 수 있음.

3가지 방법을 지원함
1. 컴파일 시점 - 위빙 : 컴파일시 `.class`를 만드는 시점에 부가 로직을 추가할 수 있다. <br> AspectJ의 특별한 컴파일러를 사용해야함. 부가 기능 코드가 핵심 기능이 있는 코드 주변에 실제로 붙어버린다. <br> **단점 : 컴파일 시점에 부가 기능을 적용하려면 특별한 컴파일러를 사용해야한다.**
2. 클래스 로딩 시점 - java instrumentation : 자바 언어는 `.class` 파일을 JVM에 저장하기 전에 조작할 수 있는 기능을 제공한다. 모니터링 툴에서 많이 씀. 로드 타임 위빙이라고 부름 <br> **단점 : 자바 실행시 특별한 옵션을 통해 클래스로더 조작기를 지정해야 하는데, 번거롭고 운영하기 어려움**
3. 런타임 시점 -> 프록시 : 자바 언어가 제공하는 범위 안에서 부가 기능을 적용해야 한다. 스프링과 같은 컨테이너, 프록시, DI, 빈 포스트 프로세서 같은 개념들을 총 동원해야 한다.

![image](https://github.com/binary-ho/TIL-public/assets/71186266/134a0cd7-e9ed-4720-90f7-549b3262350c)

<br>

## AOP 적용위치 (JoinPoint)
1. `AspectJ` : 컴파일 시점과 클래스 로딩 시점에 AOP를 적용하므로, 생성자, 필드값 접근, static 메서드 접근, 메서드 실행 등 어느 곳에나 적용 가능하다.
2. `Spring AOP` : 스프링 AOP는 프록시 방식을 사용하므로, **메서드 실행시점에만 적용 가능하다 + 메서드 오버라이딩 개념으로 동작한다.** <br> 따라서 생성자, static 메서드, 필드값 접근 등에는 프록시 적용이 어렵다. <br> 프록시 방식을 사용하는 스프링 AOP는 스프링 컨테이너가 관리할 수 있는 스프링 빈에만 AOP를 적용할 수 있다.


<br>

AspectJ는 어디든 로직을 붙일 수 있어 더 좋아보이지만, <br> 
스프링 AOP에 비해 너무 어렵다는 단점이 있다. <br>
공부할 내용도 많고, 자바 관련 설정이나 전용 문법 등 복잡한데 스프링 AOP는 별도의 추가 설정 없이 스프링만 있으면 편하게 AOP를 사용 가능하다. 
그리고 실무에서는 스프링이 제공하는 AOP 기능만 사용해도 대부분의 문제를 해결할 수 있다.


## AOP 용어 정리
1. **조인 포인트(Join point)** 
- 어드바이스가 적용될 수 있는 위치, 메소드 실행, 생성자 호출, 필드값 접근, static 메서드 접근 같은 프로그램 실행 중지점
- 조인포인트는 추상적인 개념이다. AOP를 적용할 수 있는 모든 지점이라 생각하면 된다. 
- 스프링 AOP는 프록시 방식을 사용하므로 조인 포인트는 항상 메소드 실행 지점으로 제한된다.
2. **포인트컷(Pointcut)**  
- 조인 포인트중에서 어드바이스가 적용될 위치를 선별하는 기능 
- 주로 AspectJ 표현식을 사용해서 지정 
- 프록시를 사용하는 스프링 AOP는 메서드 실행지점만 포인트컷으로 선별가능 
3. **타켓(Target)** 
- 어드바이스를 받는 객체, 포인트컷으로 결정 
4. **어드바이스(Advice)**  
- 부가기능
- 특정 조인 포인트에서 Aspect에 의해 취해지는 조치
- Around, Before, After와 같은 다양한 종류의 어드바이스가 있음 
5. **애스펙트(Aspect)** 
- 어드바이스 + 포인트컷을 모듈화 한것 
- @Aspect를 생각하면 됨
- 여러 어드바이스와 포인트컷이 함께 존재
6. **어드바이저(Advisor)** 
- 하나의 어드바이스와 하나의 포인트컷으로 구성 
- 스프링 AOP에서만 사용되는 특별한 용어 
7. **위빙(Weaving)** 
- 포인트컷으로 결정한 타켓의 조인 포인트에 어드바이스를 적용하는것 
- 위빙을 통해 핵심기능코드에 영향을 주지 않고 부가기능을 추가할수 있음 
- AOP 적용을 위해 애스펙트를 객체에 연결한 상태
- 컴파일타임(AspectJ compiler) 로드타임
- 스프링 AOP는 런타임 + 프록시방식 
8. **AOP 프록시** 
- AOP 기능을 구현하기 위해 만든 프록시 객체, 스프링에서 AOP 프록시는 JDK 동적프록시 또는 CGLIB 프록시이다.
